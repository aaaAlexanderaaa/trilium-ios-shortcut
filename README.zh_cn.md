# trilium-ios-shortcut

一个使用快捷指令给 trilium 发消息的指南

## 前置条件

要使用这个指南，你需要：

- 苹果设备，装了快捷指令 app。
- 安装了 Trilium server。

ios 15.5 可使用，其他设备没测试，ios 13 也许可用，期待反馈。

## 快捷指令特性：

这个快捷指令允许你：

- 输入文字内容并发送
- 选中任何文字内容分享并保存
- 支持读取剪贴板内容并发送，可配置开启关闭。读取剪贴板后有 4 个选项
  - 清空剪贴板
  - 引用剪贴板内容
  - 引用剪贴板内容（成功后清除）
  - 直接输入
- 支持配置固定标题，配置后将直接使用固定标题
- 支持配置可选标题，选择`自定义`后可手动输入标题
- 可设置多个默认标签，设置后将发送笔记将附带默认标签
- 支持单独name，也支持#name=value
- 可配置可选标签组，支持开启关闭从标签组中选择

## 自定义接口：

要了解更多关于custom api的信息，可看[文档](https://github.com/zadam/trilium/wiki/Custom-request-handler)

这功能比文档展示的要强大，比如它可以直接引入项目中的文件

```js
const htmlSanitizer = require("../services/html_sanitizer");
```

可通过这种方式来访问未被暴露的功能，当然也可能引发一些意外。

## Custom request handler 文件

[handler](./handler.js)

这是一个最基础的方式，你也可以创建自己喜欢的逻辑，比如增加克隆。

## 操作指南

### Trilium server

1. 首先新建一个笔记或使用老笔记
2. 类型改为`JS backend`
3. 添加一个标签`#customRequestHandler={随意的地址} `
4. [handler](./handler.js)文件代码复制进去。

这样就生成了可创建笔记的接口。

### 苹果设备

1. 用手机打开[链接]()获取快捷指令
2. 跟随指南操作。
3. 如果启用权限请允许。

### 完成

开始享受随时随地给你的 trilium 服务花式发消息吧！

## 使用建议

指令整体非常灵活。

- 当你不原意处理标题和标签，只想快速发过去，可配置启用固定标题，然后配置默认标签并关闭可选标签选项。

- 当你希望在发送前修改标题和标签，可关闭固定标题并开启选择标签，此时将获取非常灵活的输入体验。

输入正文时分为直接输入和引用输入，引用来源分为系统输入和剪贴板。引用输入时将附带`---`作为分割，你也可以在指令中修改引用输入方式。

可将快捷指令放置到主屏幕，也可添加到辅助触控中，路径为`辅助功能-触控-辅助触控`。

使用系统分享时能找到快捷指令，可翻到最下编辑操作，然后将该指令添加到收藏，及实现置顶。

## 快捷指令编写建议

快捷指令的编写非常不方便，拖动起来有 bug，并且容易误触删掉某个节点。

如果自行修改，建议多使用`拷贝`，之后`贴到上/下方`。

左下角支持回退，情况不对及时回退。

并建议在关键点复制指令留以备份。

如发现操作卡顿可退出并重新进入。

如发现指令在编写时可以运行，实际操作却运行不了，则可能需要重启手机。

编写之后很难修改，所以建议编写前可以先用伪代码实现，梳理清除逻辑，之后再到手机中编写。

可多参考其他人的指令，遇到类似需求多使用拷贝。

## 最后

本指令只在这里发布或更新，不对其他来源负责。

如果有问题或建议，欢迎提交 issue。

如果对你有用也欢迎 start。
